<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:o="http://omnifaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:h="http://xmlns.jcp.org/jsf/html">

    <h:body>


        <ui:composition template="/WEB-INF/template.xhtml"  >
            <ui:define name="tituloPagina">
                Administración de Plataformas
            </ui:define>
            <ui:define name="content">
                <script type="text/javascript">
                    function test() {
                        var i = $('.ui-row-toggler.ui-icon-circle-triangle-s').length;
                        if (i == 1) {
                            return;
                        }
                        $('.ui-row-toggler.ui-icon-circle-triangle-s').trigger('click');
                    }
                </script>
                <h:form id="formPlataforma">

                    <p:dataTable rendered="true" id="dtPlataforma" widgetVar="dttest" value="#{plataformaBean.listaPlataformas}"
                                 var="pla"  rowKey="#{pla.idPlataforma}"
                                 rowIndexVar="rowIdPlataforma" paginator="true"
								 paginatorPosition="bottom">

                        <p:column style="width:40px">
                            <p:rowToggler />
                        </p:column>

                        <p:column headerText="Nombre" filterBy="#{pla.nombre}" >
                            <p:outputLabel value="#{pla.nombre}" />
                        </p:column>

                        <p:column headerText="Descripción" filterBy="#{pla.descripcion}" style="width: 50%" >
                            <p:outputLabel value="#{pla.descripcion}" />
                        </p:column>

                        <p:column headerText="Activo" style="width: 100px; text-align: center">
                            <p:outputLabel value="#{pla.activo eq true ? 'Si' : 'No'}"  />
                        </p:column>


                        <p:column headerText="Acción">
                            <div style="position: relative; float: right;">
                                <p:commandButton icon="fa fa-pencil Fs100 Red" title="Editar" oncomplete="PF('wbPlataforma').show()"
                                                 update="formDlgPlataforma" action="#{plataformaBean.antesActualizar}">
                                    <f:setPropertyActionListener value="#{pla}" target="#{plataformaBean.plataformaSeleccionada}" />
                                    <f:setPropertyActionListener value="#{true}" target="#{plataformaBean.editando}" />
                                </p:commandButton>

                                <p:commandButton icon="fa fa-minus-circle Fs100 Red" title="Eliminar"
                                                 action="#{plataformaBean.eliminar}" update="formPlataforma:dtPlataforma formGrowl:growl">
                                    <f:setPropertyActionListener value="#{pla}" target="#{plataformaBean.plataformaSeleccionada}" />
                                    <p:confirm header="Confirmación" message="Estas seguro?" icon="pi pi-exclamation-triangle" />
                                </p:commandButton>

                                <p:commandButton  icon="fa fa-plus-circle"  value="Artefacto"
                                                  oncomplete="PF('wbArtefacto').show();" action="#{plataformaBean.antesActualizar}"
                                                  update=":formDlgArtefacto:tabv:dtArtefacto ">
                                    <f:setPropertyActionListener value="#{pla}" target="#{plataformaBean.plataformaSeleccionada}" />

                                </p:commandButton>

                            </div>
                        </p:column>

<!--                        <p:ajax event="rowToggle" listener="#{plataformaBean.onRowToggle}" >
                            <f:setPropertyActionListener value="#{pla}" target="#{plataformaBean.plataformaSeleccionada}" />
                        </p:ajax>-->

                        <p:ajax
                            event="rowToggle"
                            onstart="test();return cfg.ext.params[0].name.indexOf('_rowExpansion') != -1"
                            listener="#{plataformaBean.onRowToggle}" >
                            <f:setPropertyActionListener value="#{pla}" target="#{plataformaBean.plataformaSeleccionada}" />
                        </p:ajax>


                        <p:rowExpansion id="rwArtext" styleClass="bgExpansion" >
                            <p:dataTable id="dtArtefactoEx" value="#{plataformaBean.listaArtefactoXPlataforma}"
                                         var="rowArt"  rowKey="#{rowArt.idArtefactoXPlataforma}"
                                         paginator="false" paginatorPosition="bottom"
                                         style="width: 96%; padding-left: 40px;"
                                         editable="false" editMode="cell"
                                         rowIndexVar="rowIdArtefacto"
                                         styleClass="dtArtefactosER"
                                         >
                                <f:facet name="header">
                                    Lista de Artefactos
                                </f:facet>

                                <p:column headerText="Artefacto">
                                    <p:cellEditor>
                                        <f:facet name="output"><h:outputText value="#{rowArt.nombreArtefacto}" /></f:facet>
                                        <f:facet name="input"><p:inputText  value="#{rowArt.nombreArtefacto}" style="width:98%"/></f:facet>
                                    </p:cellEditor>
                                </p:column>

                                <p:column headerText="Descripción" style="width: 47%">
                                    <p:cellEditor>
                                        <f:facet name="output"><h:outputText value="#{rowArt.descripcion}" /></f:facet>
                                        <f:facet name="input"><p:inputText  value="#{rowArt.descripcion}" style="width:98%"/></f:facet>
                                    </p:cellEditor>
                                </p:column>

                                <p:column headerText="Activo" style="width: 7%; text-align: center">
                                    <p:cellEditor>
                                        <f:facet name="output"><h:outputText value="#{rowArt.activo eq true ? 'Si': 'No'}" /></f:facet>
                                        <f:facet name="input">
                                            <h:selectOneMenu value="#{rowArt.activo}" style="width:100%">
                                                <f:selectItem  itemValue="#{true}" itemLabel="Si"/>
                                                <f:selectItem  itemValue="#{false}" itemLabel="No"/>
                                            </h:selectOneMenu>
                                        </f:facet>
                                    </p:cellEditor>
                                </p:column>

                                <p:column headerText="Acción" style="width: 17%">
                                    <div style="position: relative; float: right;">
                                        <p:commandButton icon="fa fa-minus-circle Fs100 Red" title="Eliminar"
                                                         action="#{plataformaBean.eliminarArtefacto}" update=":formPlataforma:dtPlataforma">
                                            <f:setPropertyActionListener value="#{rowArt}" target="#{plataformaBean.artefactoSeleccionado}" />
                                            <p:confirm header="Confirmación" message="Estas seguro?" icon="pi pi-exclamation-triangle" />
                                        </p:commandButton>

                                        <p:commandButton   icon="fa fa-plus-circle"   value="Servidores"
                                                           global="false"
                                                           process=":formPlataforma:dtPlataforma:@this"
                                                           action="#{plataformaBean.cargarListaServidores}"
                                                           actionListener="#{plataformaBean.updateRecord}"
                                                           oncomplete="PF('wbServidor').show();"
                                                           update="formDlgServidor:tabvServ:dtServidorEx formDlgServidor:tabvServ:pickList">
                                            <f:setPropertyActionListener value="#{rowArt}" target="#{plataformaBean.artefactoSeleccionado}" />
                                            <f:attribute name="rowIdArtefacto" value="#{rowIdArtefacto}" />
                                            <f:attribute name="rowIdPlataforma" value="#{rowIdPlataforma}" />
                                        </p:commandButton>
                                    </div>
                                </p:column>

                                <p:ajax event="rowToggle" listener="#{plataformaBean.onRowToggle2}"
                                        >
                                    <f:setPropertyActionListener value="#{pla}" target="#{plataformaBean.plataformaSeleccionada}" />
                                </p:ajax>



                                <!--                                <p:rowExpansion id="rws">
                                                                    <p:dataTable id="dtServidorEx" value="#{plataformaBean.listaArtefactoXServidor}"
                                                                                 var="rowSer" rowKey="#{rowSer.idArtefactoXServidor}"
                                                                                 paginator="false" paginatorPosition="bottom"
                                                                                 style="width: 96%; padding-left: 40px; padding-top: 30px; padding-bottom: 30px;"
                                                                                 editable="true" editMode="cell"
                                                                                 widgetVar="dtServidoresWB"
                                                                                 styleClass="dtServidores">
                                                                        <f:facet name="header">
                                                                            Lista de Servidores
                                                                        </f:facet>

                                                                        <p:column headerText="Hostname">
                                                                            <p:cellEditor>
                                                                                <f:facet name="output"><h:outputText value="#{rowSer.idServidor.hostname}" /></f:facet>
                                                                                <f:facet name="input"><p:inputText  value="#{rowSer.idServidor.hostname}" style="width:98%"/></f:facet>
                                                                            </p:cellEditor>

                                                                        </p:column>

                                                                        <p:column headerText="IPV4">
                                                                            <p:cellEditor>
                                                                                <f:facet name="output"><h:outputText value="#{rowSer.idServidor.ipv4}" /></f:facet>
                                                                                <f:facet name="input"><p:inputText  value="#{rowSer.idServidor.ipv4}" style="width:98%"/></f:facet>
                                                                            </p:cellEditor>

                                                                        </p:column>

                                                                        <p:column headerText="IPV4">
                                                                            <p:cellEditor>
                                                                                <f:facet name="output"><h:outputText value="#{rowSer.idServidor.descripcion}" /></f:facet>
                                                                                <f:facet name="input"><p:inputText  value="#{rowSer.idServidor.descripcion}" style="width:98%"/></f:facet>
                                                                            </p:cellEditor>

                                                                        </p:column>




                                                                        <p:column headerText="Activo" style="width: 7%; text-align: center">
                                                                            <p:cellEditor>
                                                                                <f:facet name="output"><h:outputText value="#{rowSer.idServidor.activo eq true ? 'Si': 'No'}" /></f:facet>
                                                                                <f:facet name="input">
                                                                                    <h:selectOneMenu value="#{rowSer.idServidor.activo}" style="width:100%">
                                                                                        <f:selectItem  itemValue="#{true}" itemLabel="Si"/>
                                                                                        <f:selectItem  itemValue="#{false}" itemLabel="No"/>
                                                                                    </h:selectOneMenu>
                                                                                </f:facet>
                                                                            </p:cellEditor>
                                                                        </p:column>

                                                                        <p:column headerText="Acción" style="width: 17%">
                                                                            <div style="position: relative; float: right;">
                                                                                <p:commandButton icon="fa fa-minus-circle Fs100 Red" title="Eliminar Servidor"
                                                                                                 action="#{plataformaBean.eliminarArtefactoServidor}"
                                                                                                 actionListener="#{plataformaBean.updateRecord}">
                                                                                    <f:setPropertyActionListener value="#{rowSer}" target="#{plataformaBean.artefactoXServidorSeleccionado}" />
                                                                                    <f:setPropertyActionListener value="#{rowArt}" target="#{plataformaBean.artefactoSeleccionado}" />
                                                                                    <p:confirm header="Confirmación" message="Estas seguro?" icon="pi pi-exclamation-triangle" />
                                                                                    <f:attribute name="rowIdArtefacto" value="#{rowIdArtefacto}" />
                                                                                    <f:attribute name="rowIdPlataforma" value="#{rowIdPlataforma}" />
                                                                                </p:commandButton>

                                                                            </div>
                                                                        </p:column>
                                                                    </p:dataTable>
                                                                </p:rowExpansion>-->
                            </p:dataTable>
                        </p:rowExpansion>


                    </p:dataTable>

                    <div class="float-sm-right" style="padding-top: 10px;">
                        <p:commandButton value="Agregar Plataforma" ajax="true" icon="fa fa-plus-circle"
                                         oncomplete="PF('wbPlataforma').show();"
                                         actionListener="#{plataformaBean.agregar}"
                                         update="formDlgPlataforma">
                            <f:setPropertyActionListener value="#{false}" target="#{plataformaBean.editando}" />
                        </p:commandButton>
                    </div>
                    <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
                        <p:commandButton value="Si" type="button" styleClass="ui-confirmdialog-yes" icon="pi pi-check" />
                        <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no" icon="pi pi-times" />
                    </p:confirmDialog>
                </h:form>

                <p:dialog id="dlgArtefacto" widgetVar="wbArtefacto" closeOnEscape="true" closable="true"
                          header="Agregar Artefacto"
                          width="1050" height="650" minHeight="650" appendTo="@(body)">

                    <h:form id="formDlgArtefacto">
                        <p:tabView id="tabv" dynamic="true" cache="false" activeIndex="#{plataformaBean.tabIndex}">


                            <p:tab rendered="true" id="tabArtefactos"  title="Agregar Artefactos">
                                <h:panelGroup id="datosArtefactos">

                                    <div class="form-group row">
                                        <label  class="col-sm-2 col-form-label">Nombre Artefacto</label>
                                        <div class="col-sm-10">
                                            <p:inputText  styleClass="form-control" required="false"
                                                          value="#{plataformaBean.nombreArtefacto}"/>
                                        </div>
                                    </div>

                                    <div class="form-group row">
                                        <label  class="col-sm-2 col-form-label">Descripción</label>
                                        <div class="col-sm-10">
                                            <p:inputText styleClass="form-control" required="false"
                                                         value="#{plataformaBean.descripcionArtefacto}"/>
                                        </div>
                                    </div>


                                    <div class="form-group row">
                                        <label  class="col-sm-2 col-form-label">Activo</label>
                                        <div class="col-sm-10">
                                            <p:selectBooleanCheckbox required="false"
                                                                     value="#{plataformaBean.activoArtefacto}"/>
                                        </div>
                                    </div>

                                </h:panelGroup>

                                <h:panelGroup id="panelBtnActualizar">
                                    <div class="float-sm-left" style="padding-top: 10px;">
                                        <p:commandButton value="Agregar a lista" ajax="true" icon="fa fa-plus-circle"
                                                         process="tabArtefactos"
                                                         action="#{plataformaBean.agregarListaArtefactos}"
                                                         update="dtArtefacto datosArtefactos" >

                                        </p:commandButton>

                                    </div>
                                </h:panelGroup>



                                <p:dataTable id="dtArtefacto" value="#{plataformaBean.listaArtefactoXPlataforma}"
                                             var="row" rows="3" rowKey="#{row.idArtefactoXPlataforma}"
                                             paginator="true" paginatorPosition="bottom"
                                             style="padding-top: 60px;width: 952px;"
                                             editable="true" editMode="cell">
                                    <f:facet name="header">
                                        Lista de Artefactos
                                    </f:facet>

                                    <p:column headerText="Artefacto">
                                        <p:cellEditor>
                                            <f:facet name="output"><h:outputText value="#{row.nombreArtefacto}" /></f:facet>
                                            <f:facet name="input"><p:inputText  value="#{row.nombreArtefacto}" style="width:98%"/></f:facet>
                                        </p:cellEditor>

                                    </p:column>

                                    <p:column headerText="Descripción">
                                        <p:cellEditor>
                                            <f:facet name="output"><h:outputText value="#{row.descripcion}" /></f:facet>
                                            <f:facet name="input"><p:inputText  value="#{row.descripcion}" style="width:98%"/></f:facet>
                                        </p:cellEditor>
                                    </p:column>

                                    <p:column headerText="Activo">
                                        <p:cellEditor>
                                            <f:facet name="output"><h:outputText value="#{row.activo eq true ? 'Si': 'No'}" /></f:facet>
                                            <f:facet name="input">
                                                <h:selectOneMenu value="#{row.activo}" style="width:100%">
                                                    <f:selectItem  itemValue="#{true}" itemLabel="Si"/>
                                                    <f:selectItem  itemValue="#{false}" itemLabel="No"/>
                                                </h:selectOneMenu>
                                            </f:facet>
                                        </p:cellEditor>
                                    </p:column>

                                    <p:column headerText="Acción">
                                        <center>
                                            <p:commandButton icon="fa fa-minus-circle Fs100 Red" title="Eliminar"
                                                             action="#{plataformaBean.eliminarArtefacto}" update=":formDlgArtefacto:tabv:dtArtefacto">
                                                <f:setPropertyActionListener value="#{row}" target="#{plataformaBean.artefactoSeleccionado}" />
                                                <p:confirm header="Confirmación" message="Estas seguro?" icon="pi pi-exclamation-triangle" />
                                            </p:commandButton>
                                        </center>
                                    </p:column>

                                </p:dataTable>

                            </p:tab>
                        </p:tabView>


                        <center>
                            <p:commandButton  styleClass="ui-priority-primary" value="Actualizar" style="width: 100px;"
                                              action="#{plataformaBean.actualizarArtefacto}"
                                              update="formPlataforma:dtPlataforma formGrowl:growl"
                                              process="@this @form"
                                              />

                            <p:commandButton  styleClass="ui-priority-secondary" value="Salir" style="width: 80px;"
                                              onclick="PF('wbArtefacto').hide()"></p:commandButton>

                        </center>
                    </h:form>
                </p:dialog>



                <p:dialog id="dlgPlataforma" widgetVar="wbPlataforma" closeOnEscape="true" closable="true" header="Plataforma"
                          width="550" height="300" minHeight="650" appendTo="@(body)">
                    <h:form id="formDlgPlataforma">

                                <div class="bd-example">
                                    <div class="form-group row">
                                        <label for="codigo" class="col-sm-2 col-form-label">Nombre</label>
                                        <div class="col-sm-10">
                                            <p:inputText id="codigo" styleClass="form-control" required="false"
                                                         value="#{plataformaBean.plataformaSeleccionada.nombre}"/>
                                        </div>
                                    </div>

                                    <div class="form-group row">
                                        <label for="nombre" class="col-sm-2 col-form-label">Descripción</label>
                                        <div class="col-sm-10">
                                            <p:inputText id="nombre" styleClass="form-control" required="false"
                                                         value="#{plataformaBean.plataformaSeleccionada.descripcion}"/>
                                        </div>
                                    </div>

                                    <div class="form-group row">
                                        <label for="nombre" class="col-sm-2 col-form-label">Activo</label>
                                        <div class="col-sm-10">
                                            <p:selectBooleanCheckbox required="false"
                                                                     value="#{plataformaBean.plataformaSeleccionada.activo}"/>
                                        </div>
                                    </div>
                                </div>

                        <center>
                            <p:commandButton  styleClass="ui-priority-primary" value="Guardar" style="width: 80px;"
                                              action="#{plataformaBean.guardar}"
                                              update="formPlataforma:dtPlataforma formGrowl:growl"
                                              process="@this @form"
                                              rendered="#{!plataformaBean.editando}"
                                              />

                            <p:commandButton  styleClass="ui-priority-primary" value="Actualizar" style="width: 100px;"
                                              action="#{plataformaBean.actualizar}"
                                              update="formPlataforma:dtPlataforma formGrowl:growl"
                                              process="@this @form"
                                              rendered="#{plataformaBean.editando}"
                                              />

                            <p:commandButton  styleClass="ui-priority-secondary" value="Salir" style="width: 80px;"
                                              onclick="PF('wbPlataforma').hide()"></p:commandButton>

                        </center>
                    </h:form>
                </p:dialog>


                <p:dialog id="dlgServidor" widgetVar="wbServidor" closeOnEscape="true" closable="true"
                          header="Servidores"
                          width="950" height="450" minHeight="650" appendTo="@(body)">

                    <h:form id="formDlgServidor">

                        <p:tabView id="tabvServ">
                            <p:tab title="Servidores seleccionados">
                                <p:dataTable id="dtServidorEx" value="#{plataformaBean.listaArtefactoXServidor}"
                                             var="rowSer" rowKey="#{rowSer.idArtefactoXServidor}"
                                             rows="5"
                                             paginator="true" paginatorPosition="bottom"
                                             style="width: 96%; padding-left: 40px; padding-top: 30px; padding-bottom: 30px;"
                                             editable="true" editMode="cell"
                                             widgetVar="dtServidoresWB"
                                             styleClass="dtServidores">
                                    <f:facet name="header">
                                        Lista de Servidores
                                    </f:facet>

                                    <p:column headerText="Hostname">
                                        <p:cellEditor>
                                            <f:facet name="output"><h:outputText value="#{rowSer.idServidor.hostname}" /></f:facet>
                                            <f:facet name="input"><p:inputText  value="#{rowSer.idServidor.hostname}" style="width:98%"/></f:facet>
                                        </p:cellEditor>

                                    </p:column>

                                    <p:column headerText="IPV4">
                                        <p:cellEditor>
                                            <f:facet name="output"><h:outputText value="#{rowSer.idServidor.ipv4}" /></f:facet>
                                            <f:facet name="input"><p:inputText  value="#{rowSer.idServidor.ipv4}" style="width:98%"/></f:facet>
                                        </p:cellEditor>

                                    </p:column>

                                    <p:column headerText="Descripción">
                                        <p:cellEditor>
                                            <f:facet name="output"><h:outputText value="#{rowSer.idServidor.descripcion}" /></f:facet>
                                            <f:facet name="input"><p:inputText  value="#{rowSer.idServidor.descripcion}" style="width:98%"/></f:facet>
                                        </p:cellEditor>

                                    </p:column>

                                    <p:column headerText="Activo" style="width: 7%; text-align: center">
                                        <p:cellEditor>
                                            <f:facet name="output"><h:outputText value="#{rowSer.idServidor.activo eq true ? 'Si': 'No'}" /></f:facet>
                                            <f:facet name="input">
                                                <h:selectOneMenu value="#{rowSer.idServidor.activo}" style="width:100%">
                                                    <f:selectItem  itemValue="#{true}" itemLabel="Si"/>
                                                    <f:selectItem  itemValue="#{false}" itemLabel="No"/>
                                                </h:selectOneMenu>
                                            </f:facet>
                                        </p:cellEditor>
                                    </p:column>

                                    <p:column headerText="Acción" style="width: 23%" rendered="false">
                                        <div style="position: relative; float: right;">
                                            <p:commandButton icon="fa fa-minus-circle Fs100 Red" title="Eliminar Servidor"
                                                             action="#{plataformaBean.eliminarArtefactoServidor}"
                                                             actionListener="#{plataformaBean.updateRecord}">
                                                <f:setPropertyActionListener value="#{rowSer}" target="#{plataformaBean.artefactoXServidorSeleccionado}" />
                                                <f:setPropertyActionListener value="#{rowArt}" target="#{plataformaBean.artefactoSeleccionado}" />
                                                <p:confirm header="Confirmación" message="Estas seguro?" icon="pi pi-exclamation-triangle" />
                                                <f:attribute name="rowIdArtefacto" value="#{rowIdArtefacto}" />
                                                <f:attribute name="rowIdPlataforma" value="#{rowIdPlataforma}" />
                                            </p:commandButton>

                                        </div>
                                    </p:column>
                                </p:dataTable>
                            </p:tab>
                            <p:tab title="Agregar Servidores">
                                <div id="datosServidores" style="display: block;margin-left: auto;margin-right: auto;">
                                    <p:pickList id="pickList" value="#{plataformaBean.servidorDualList}"
                                                var="serv" itemLabel="#{serv.hostname}" itemValue="#{serv}"
                                                converter="entityConverter"
                                                showSourceFilter="true" showTargetFilter="true"
                                                filterMatchMode="contains" >
                                    </p:pickList>


                                </div>

                               <center style="padding-top: 40px;">
                                    <p:commandButton  styleClass="ui-priority-primary" value="Actualizar" style="width: 100px;"
                                                      action="#{plataformaBean.guardarArtefactoXServidor}"
                                                      update="@(.dtServidores) formGrowl:growl"
                                                      process="@this @form"
                                                      />

                                    <p:commandButton  styleClass="ui-priority-secondary" value="Salir" style="width: 80px;"
                                                      onclick="PF('wbArtefacto').hide()"></p:commandButton>

                                </center>
                            </p:tab>


                        </p:tabView>



                    </h:form>
                </p:dialog>

            </ui:define>

        </ui:composition>
    </h:body>
</html>


